---
title: "PhenoGeneRanker"
author: "Cagatay Dursun, Jake Petrie,  Serdar Bozdag"
date: "7/15/2020"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{PhenoGeneRanker}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(PhenoGeneRankerPackage)
```
# Table of Contents
  - [Introduction](#Introduction)
  - [Using the Methods](#Using-the-Methods)  
    - [Input File Formatting](#Input-File-Formatting)  
    - [CreateWalkMatrix](#CreateWalkMatrix)  
    - [RandomWalkRestart](#randomwalkrestart)  
  - [Example Workflow](#Example-Workflow)
  - [Acknowledgements](#Acknowledgements)
  
## <a id = "Introduction"></a> Introduction

PhenoGeneRanker is a gene and phenotype prioritization tool that utilizes a heterogeneous gene-phenotype network. PhenoGeneRanker allows multi-layer gene and disease networks. It also calculates empirical p-values of gene ranking using random stratified sampling of genes based on their connectivity degree in the network.

# Load PhenoGeneRanker

Loading the package will make it usable and check to make sure that all of the nessecary packages are also installed. 

```{r}
library(PhenoGeneRankerPackage)
```

## <a id = "Using-the-Methods"></a> Using the Methods

* CreateWalkMatrix
* randomwalkrestart


## <a id = "Input-File-Formatting"></a> Input File Formatting
The CreateWalkMatrix method takes in an _input file_ as a parameter. This file is a ".txt" file with two tab-separated columns which hold the data files you would like to work with. The header row must say “type” and “file_name” for each of the two columns. The type column contains what kind of data is stored in the file. These can be either gene, phenotype, or bipartite file types. The file_name column stores the name of your data file along with the “.txt” extension.   

This file should look something like this:
```
type    file_name  
gene    geneFile1.txt 
gene    geneFile2.txt
phenotype    phenotypeFile1.txt  
phenotype    phenotypeFile2.txt
bipartite    bipartiteFile.txt  
```

Inside each of the file_name files, there is a “from”, “to”, and “weight” column. These are all tab-separated. For the gene and phenotype files, the “from” and “to” columns will contain the names of the genes and phenotypes, the row order doesn’t matter. The “weight” column will have the weight of the relationship between the genes and phenotypes. All unweighted networks must have a value of 1 in the weight column. For the bipartite file, the “from” column must contain gene names and the “to” column must have phenotype names. The meaning and usage of the weight column are analogous to the gene and phenotype files.  

The geneFile1.txt from the previous example could look like this:
```
from     to       weight  
gene1    gene2    1  
gene1    gene3    1  
gene2    gene4    1 
...      ...      ...
```
The phenotype files could look like this:
```
from     to       weight  
pheno1   pheno2   1  
pheno1   pheno3   1  
pheno3   pheno5   1  
...      ...      ...
```
The bipartite file would look like this:
```
from     to        weight  
gene1    pheno1    1  
gene2    pheno2    1 
...      ...       ...
```

## <a id = "CreateWalkMatrix"></a> CreateWalkMatrix

This method generates a walk matrix from gene and phenotype data. It takes in an *input-file name* as a parameter. It has to be a '.txt' file. Instructions on how to format the input file and the necessary data files can be found in the [input file formatting](#Input-File-Formatting) section above.

The rest of the parameters are useful if you would like to alter your resulting matrix. The parameter *numCores* is the number of cores used for parallel processing, it defaults to a value of 1. It is recommended to use detectCores() for this parameter. The parameter *delta* is the probability of jumping between gene layers. It has a range of 0 to 1 and a default value of 0.5. The parameter *zeta* is the probability of jumping between phenotype layers. It has a range of 0 to 1 and a default value of 0.5. The parameter *lambda* is the inter-network jump probability. It has a range of 0 to 1 and a default value of 0.5.

The returned list is what will be used in the randomwalkrestart() method.

```{r eval=FALSE}
walkMatrix <-CreateWalkMatrix('file.txt')
CreateWalkMatrix('file.txt', detectCores(), 0.4, 0.7, 0.9)
```

This method returns a list containing the walk matrix, a sorted list of gene pool nodes, a sorted list of phenotype pool nodes, the connectivity of the genes, the connectivity of the phenotypes the number of genes, the number of phenotypes, the number of gene pool nodes,  and the number of phenotype pool nodes. You can access each of these elements as shown below. 
```{r eval=FALSE}
walkMatrix[[“WM”]] # accesses the walk matrix itself
walkMatrix[[“genes”]] # accesses the sorted gene pool nodes
walkMatrix[[“phenotypes”]] # accesses the sorted phenotype pool nodes
walkMatrix[[“gene_connectivity”]] # accesses the degree of all the genes in the network
walkMatrix[[“phenotype_connectivity”]] # accesses the degree of all the phenotypes in the network
walkMatrix[[“LG”]] # the number of genes in the network
walkMatrix[[“LP”]] # the number of phenotypes in the network
walkMatrix[[“N”]] # the number of gene pool nodes
walkMatrix[[“M”]] # the number of phenotype pool nodes
```


## <a id = "randomwalkrestart"></a> RandomWalkRestart

This method runs the random walk with restart on the provided walk matrix. This method uses a parameter called *geneSeeds* and *phenoSeeds*, wich are vectors containing the names of genes and phenotypes that you would like to use in the ranking process. These are vectors that store strings of gene and phenotype names.

The method also uses a parameter called *generatePValues* which determines the resulting data frame. If the parameter *generatePvalue* is FALSE, the method returns a data frame including gene names and the steady-state scores of the genes. These are sorted in their rank order. The first index is rank 1 and the rest of the genes' ranks below correspond to their indices. If *generatePvalue* is TRUE then it generates p-values along with the ranks with respect to offset value of 100.

The parameter *numCores* causes the algorithm to run faster by allowing parallel processing throughout the number of cores available. For the most efficient runtime, it is recommended that the detectCores() method from the parallel package is used for this parameter. 

In order to control the global restart probability, you can change the *r* parameter value. It has a range from 0 to 1 and it has a default value of 0.7.

The individual network restart probability can be controlled by the parameter *eta*. Eta has a range from 0 to 1 and it has a default value of 0.5.

The last two parameters are optional if you would like to control the amount of weight given to each of the layer files. *tau* is a vector that stores weights for each of the 'gene' input files that were added in CreateWalkMatrix. Each index of the vector corresponds to the order of the files in your input file. They must sum up to the same number of gene files you added. *phi* is a vector that stores weights for each of the 'phenotype'  input files that were added in CreateWalkMatrix. Each index of the vector corresponds to the order of the files in your input file. They must sum up to the same number of phenotype files you added. If you want to have each file equally weighted, you do not need to input these vectors into the method.

```{r eval=FALSE}
RWR <- RandomWalkRestart(walkMatrix, c('gene1', 'gene2'), c(), TRUE)
RWR <- RandomWalkRestart(CreateWalkMatrix('myFile.txt'),c('gene1'), c('phenotype1', 'phenotype2'), FALSE)
RWR <- RandomWalkRestart(CreateWalkMatrix('myFile.txt'),c('gene1'), c(), TRUE, 12, 0.7, 0.6, “tau”=(1,0.5,1.5), “phi”=(1,0.5,1.5))
```

If the generatePvalues parameter is TRUE, the resulting data frame looks like this.
```
gene    score     P100
g1      1.9e-3    0.020000000
g425    1.6e-3    0.030000000
g77     1.3e-3    0.120000000
...     ...       ...
```
If the generatePvalues parameter is FALSE, the resulting data frame looks like this.
```
gene    score
gene47  8.877424e-04
gene202 8.219792e-04
gene33  5.779120e-04
...     ...     ...
```


## <a id = "Example-Workflow"></a> Example Workflow

```{r eval=FALSE}
walkMatrix <-CreateWalkMatrix('file.txt')
rankedGenes <-randomwalkrestart(walkMatrix, c('gene1', 'gene2'), c())
pValues <- RandomWalkRestart(walkMatrix ,c('gene1'), c(), TRUE, 12, 0.7, 0.6, “tau”=(1,0.5,1.5), “phi”=(1,0.5,1.5))
```


## <a id = "Acknowledgements"></a> Acknowledgements

